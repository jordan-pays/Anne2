#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>

int main(int argc, char **argv){
	int clef = atoi(argv[3]);// atoi passe un char en int 
	int input = open(argv[1],O_RDONLY);
	int output = open(argv[2],O_CREAT|O_WRONLY, 0644);
	if(input == -1){
		perror("erreur d ouverture de fichier");
	}
	int nblus=-1;
	char *source= malloc(sizeof(char));
	char ch;
	char *arrivee=malloc(sizeof(char));
	while (nblus!=0){
		nblus=read(input,source,1);
		ch=*source;
		if(ch>=65 && ch<=90){
			ch=ch+clef;
			if(ch>90){
				ch=65+clef;	
			}else{
				if(ch<65){
					ch=90+clef;
				}
			}
		} else {
			if(ch>=97 && ch<=122){
				ch=ch+clef;
				if(ch>122){
					ch=97+clef;
				}else{
					if(ch<97){
						ch=122+clef;
					}
				}
			}
		}
		*arrivee=ch;
		write(output,arrivee,1);
	}
	close(input);
	close(output);
}